<style>
    .project-list-container {
        padding: 20px;
        max-width: 1400px;
        margin: 0 auto;
    }

    .search-box {
        padding: 5px;
        border: 1px solid #ced4da;
        border-radius: 4px;
        flex: 1;
        font-size: 14px;
    }

    .filter-select {
        padding: 5px;
        border: 1px solid #ced4da;
        border-radius: 4px;
        font-size: 14px;
        min-width: 150px;
        background-color: white;
    }

    .controls-row {
        display: flex;
        gap: 10px;
        margin-bottom: 20px;
        align-items: center;
    }

    .project-list {
        border: 1px solid #dee2e6;
        border-radius: 4px;
        overflow: hidden;
        margin-bottom: 20px;
    }

    .project-item {
        padding: 15px;
        border-bottom: 1px solid #dee2e6;
        cursor: pointer;
        transition: background-color 0.2s;
        position: relative;
    }

    .project-item:hover {
        background-color: #f8f9fa;
    }

    .project-item.active {
        background-color: #e7f3ff;
        border-left: 3px solid #007bff;
    }

    .project-item:last-child {
        border-bottom: none;
    }

    .project-header {
        font-weight: bold;
        font-size: 16px;
        margin-bottom: 5px;
    }

    .project-meta {
        font-size: 13px;
        color: #6c757d;
    }

    .btn-add-project {
        white-space: nowrap;
    }

    /* Project Detail View */
    .project-detail-view {
        display: none;
        border: 1px solid #dee2e6;
        border-radius: 4px;
        padding: 20px;
        margin-bottom: 20px;
        background: #fff;
    }

    .project-detail-view.active {
        display: block;
    }

    .project-detail-header {
        display: flex;
        align-items: center;
        gap: 15px;
        padding-bottom: 15px;
        border-bottom: 1px solid #dee2e6;
        margin-bottom: 15px;
        flex-wrap: wrap;
    }

    .project-detail-title {
        font-size: 18px;
        font-weight: bold;
        color: #007bff;
        cursor: pointer;
        text-decoration: none;
    }

    .project-detail-title:hover {
        text-decoration: underline;
    }

    .edit-external-link {
        color: #adb5bd;
        font-size: 14px;
        text-decoration: none;
    }

    .edit-external-link:hover {
        color: #6c757d;
    }

    .completeness-badge {
        background: #e9ecef;
        color: #495057;
        padding: 4px 10px;
        border-radius: 12px;
        font-size: 13px;
    }

    .completeness-badge.low { background: #f8d7da; color: #721c24; }
    .completeness-badge.medium { background: #fff3cd; color: #856404; }
    .completeness-badge.high { background: #d4edda; color: #155724; }

    .close-detail-btn {
        margin-left: auto;
        background: none;
        border: none;
        font-size: 20px;
        cursor: pointer;
        color: #6c757d;
        padding: 0 5px;
    }

    .close-detail-btn:hover {
        color: #343a40;
    }

    /* Info table */
    .project-info-table {
        width: 100%;
        font-size: 14px;
        margin-bottom: 8px;
    }

    .project-info-table td {
        padding: 0px 15px 8px 0;
        vertical-align: top;
    }

    .project-info-table .label {
        color: #6c757d;
        font-weight: 500;
        white-space: nowrap;
        text-align: right;
        padding-right: 8px;
    }

    .project-info-table .value {
        color: #212529;
    }

    /* Tabs */
    .detail-tabs {
        display: flex;
        gap: 0;
        border-bottom: 2px solid #007bff;
        margin-bottom: 20px;
    }

    .detail-tab {
        padding: 10px 20px;
        cursor: pointer;
        background: #f8f9fa;
        border: 1px solid #dee2e6;
        border-bottom: none;
        border-radius: 4px 4px 0 0;
        margin-right: 2px;
        font-weight: 500;
        color: #6c757d;
    }

    .detail-tab.active {
        background: #fff;
        border-color: #007bff;
        border-bottom: 2px solid #fff;
        margin-bottom: -2px;
        color: #007bff;
    }

    .detail-tab:hover:not(.active) {
        background: #e9ecef;
    }

    .tab-content {
        display: none;
    }

    .tab-content.active {
        display: block;
    }

    /* Estimate table */
    .estimate-table-container {
        overflow-x: auto;
    }

    .estimate-table {
        width: 100%;
        border-collapse: collapse;
        font-size: 14px;
    }

    .estimate-table thead {
        position: sticky;
        top: 0;
        background-color: #f8f9fa;
        z-index: 10;
    }

    .estimate-table th {
        padding: 12px 8px;
        text-align: left;
        border-bottom: 2px solid #007bff;
        font-weight: bold;
        white-space: nowrap;
    }

    .estimate-table th:first-child { width: 50px; text-align: center; }
    .estimate-table th:nth-child(2) { min-width: 250px; }
    .estimate-table th:nth-child(3) { width: 80px; text-align: right; }
    .estimate-table th:nth-child(4) { width: 80px; }
    .estimate-table th:nth-child(5) { width: 100px; text-align: right; }
    .estimate-table th:nth-child(6) { width: 100px; text-align: right; }
    .estimate-table th:nth-child(7) { min-width: 200px; }
    .estimate-table th:last-child { width: 80px; text-align: center; }

    .estimate-table td {
        padding: 2px;
        border-bottom: 1px solid #dee2e6;
        vertical-align: middle;
    }

    .estimate-table tbody tr {
        cursor: move;
    }

    .estimate-table tbody tr:hover {
        background-color: #f8f9fa;
    }

    .estimate-table tbody tr.dragging {
        opacity: 0.5;
        background-color: #e7f3ff;
    }

    .estimate-table input[type="text"],
    .estimate-table input[type="number"],
    .estimate-table select {
        width: 100%;
        padding: 2px;
        border: 1px solid #ced4da;
        border-radius: 4px;
        font-size: 14px;
        box-sizing: border-box;
    }

    /* Remove arrows from number inputs */
    .estimate-table input[type="number"]::-webkit-outer-spin-button,
    .estimate-table input[type="number"]::-webkit-inner-spin-button {
        -webkit-appearance: none;
        margin: 0;
    }
    .estimate-table input[type="number"] {
        -moz-appearance: textfield;
    }

    .estimate-table input[type="number"] {
        text-align: right;
    }

    .estimate-table .row-number {
        text-align: center;
        font-weight: 500;
        color: #6c757d;
    }

    .estimate-table .row-actions {
        text-align: center;
    }

    .estimate-table .sum-cell {
        text-align: right;
        font-weight: 500;
    }

    /* Work types badges */
    .work-types-cell {
        display: flex;
        flex-wrap: wrap;
        gap: 5px;
        align-items: center;
    }

    .work-type-badge {
        display: inline-flex;
        align-items: center;
        background: #e7f3ff;
        color: #0056b3;
        padding: 3px 8px;
        border-radius: 12px;
        font-size: 12px;
        white-space: nowrap;
    }

    .work-type-badge .remove-btn {
        margin-left: 5px;
        cursor: pointer;
        font-weight: bold;
        color: #6c757d;
    }

    .work-type-badge .remove-btn:hover {
        color: #dc3545;
    }

    .add-work-type-btn {
        background: #007bff;
        color: white;
        border: none;
        border-radius: 50%;
        width: 22px;
        height: 22px;
        cursor: pointer;
        font-size: 14px;
        display: inline-flex;
        align-items: center;
        justify-content: center;
    }

    .add-work-type-btn:hover {
        background: #0056b3;
    }

    .clear-work-types-btn {
        background: #dc3545;
        color: white;
        border: none;
        border-radius: 50%;
        width: 22px;
        height: 22px;
        cursor: pointer;
        font-size: 14px;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        margin-left: 2px;
    }

    .clear-work-types-btn:hover {
        background: #c82333;
    }

    /* Work type selector modal */
    .work-type-selector {
        position: fixed;
        background: white;
        border: 1px solid #ced4da;
        border-radius: 4px;
        padding: 15px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        z-index: 1000;
        min-width: 450px;
        max-width: calc(100vw - 40px);
        max-height: calc(100vh - 40px);
        resize: both;
        overflow: auto;
    }

    .work-type-selector::-webkit-resizer {
        background: linear-gradient(135deg, transparent 50%, #ced4da 50%);
        border-radius: 0 0 4px 0;
    }

    .work-type-selector .selector-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 10px;
    }

    .work-type-selector .close-selector {
        background: none;
        border: none;
        font-size: 18px;
        cursor: pointer;
        color: #6c757d;
    }

    .work-type-selector .form-group {
        margin-bottom: 10px;
    }

    .work-type-selector label {
        display: block;
        margin-bottom: 5px;
        font-weight: 500;
        font-size: 13px;
    }

    .work-type-selector select {
        width: 100%;
        padding: 8px;
        border: 1px solid #ced4da;
        border-radius: 4px;
        font-size: 14px;
    }

    .work-type-selector .search-input {
        width: 100%;
        padding: 8px;
        border: 1px solid #ced4da;
        border-radius: 4px;
        font-size: 14px;
        margin-bottom: 10px;
    }

    .work-type-selector .add-btn {
        width: 100%;
        margin-top: 10px;
    }

    /* Constructions table */
    .constructions-table-container {
        overflow-x: auto;
    }

    .constructions-table {
        width: 100%;
        border-collapse: collapse;
        font-size: 14px;
    }

    .constructions-table thead {
        position: sticky;
        top: 0;
        background-color: #f8f9fa;
        z-index: 10;
    }

    .constructions-table th {
        padding: 12px 8px;
        text-align: left;
        border-bottom: 2px solid #007bff;
        font-weight: bold;
        white-space: nowrap;
    }

    .constructions-table th:first-child { width: 40px; text-align: center; }
    .constructions-table th { min-width: 60px; }
    .constructions-table th.col-checkbox { width: 20px; min-width: 20px; max-width: 20px; padding: 4px 2px; text-align: center; }
    .constructions-table td.col-checkbox { width: 20px; min-width: 20px; max-width: 20px; padding: 4px 2px; text-align: center; vertical-align: middle; }
    .constructions-table .compact-checkbox { width: 13px; height: 13px; margin: 0; cursor: pointer; }
    .constructions-table th.col-construction { min-width: 120px; }
    .constructions-table th.col-estimate { min-width: 120px; background-color: #e7f3ff; }
    .constructions-table th.col-product { min-width: 80px; background-color: #fff3cd; }

    .constructions-table td {
        padding: 8px;
        border-bottom: 1px solid #dee2e6;
        vertical-align: top;
    }

    .constructions-table tbody tr {
        cursor: default;
    }

    .constructions-table tbody tr:hover {
        background-color: #f8f9fa;
    }

    .constructions-table tbody tr.dragging {
        opacity: 0.5;
        background-color: #e7f3ff;
    }

    .constructions-table input[type="text"] {
        width: 100%;
        padding: 6px 8px;
        border: 1px solid #ced4da;
        border-radius: 4px;
        font-size: 14px;
    }

    .constructions-table .row-number {
        text-align: center;
        font-weight: 500;
        color: #6c757d;
    }

    .constructions-table .row-actions {
        text-align: center;
    }

    /* Nested tables styles */
    .nested-table {
        width: 100%;
        border-collapse: collapse;
        font-size: 12px;
        margin: 0;
    }

    .nested-table th {
        padding: 4px 6px;
        background-color: #e9ecef;
        border: 1px solid #dee2e6;
        font-weight: 600;
        font-size: 11px;
        white-space: nowrap;
    }

    .nested-table td {
        padding: 4px 6px;
        border: 1px solid #dee2e6;
        vertical-align: top;
    }

    .nested-table-container {
        max-height: 200px;
        overflow-y: auto;
        border: 1px solid #dee2e6;
        border-radius: 4px;
    }

    .products-table {
        width: 100%;
        border-collapse: collapse;
        font-size: 11px;
        margin-top: 4px;
    }

    .products-table th {
        padding: 3px 4px;
        background-color: #f8f9fa;
        border: 1px solid #dee2e6;
        font-weight: 500;
        font-size: 10px;
    }

    .products-table td {
        padding: 3px 4px;
        border: 1px solid #dee2e6;
    }

    .no-data-cell {
        color: #6c757d;
        font-style: italic;
        text-align: center;
        padding: 8px;
    }

    /* Merged cell styles */
    .constructions-table td[rowspan] {
        vertical-align: middle;
        border-right: 2px solid #dee2e6;
    }

    .constructions-table td.estimate-cell {
        background-color: #f8fbff;
        position: relative;
    }

    .constructions-table td.estimate-cell .add-product-icon {
        position: absolute;
        right: 4px;
        top: 50%;
        transform: translateY(-50%);
        color: #adb5bd;
        cursor: pointer;
        font-size: 20px;
        font-weight: bold;
        opacity: 0;
        transition: opacity 0.2s;
    }

    .constructions-table td.estimate-cell:hover .add-product-icon {
        opacity: 1;
    }

    .constructions-table td.estimate-cell .add-product-icon:hover {
        color: #007bff;
    }

    .constructions-table td.product-cell {
        background-color: #fffef8;
    }

    .constructions-table td.product-cell.editable {
        cursor: pointer;
    }

    .constructions-table td.product-cell.editable:hover {
        background-color: #fff3cd;
    }

    .constructions-table td.product-cell.editing {
        padding: 2px;
        background-color: #fff;
    }

    .constructions-table td.product-cell.editing input,
    .constructions-table td.product-cell.editing select {
        width: 100%;
        padding: 4px 6px;
        border: 1px solid #007bff;
        border-radius: 3px;
        font-size: 12px;
        box-sizing: border-box;
    }

    .constructions-table td.product-cell.editing input:focus,
    .constructions-table td.product-cell.editing select:focus {
        outline: none;
        box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.25);
    }

    .constructions-table td.product-cell.editing input[type="number"] {
        text-align: right;
    }

    /* Remove spinner buttons from number inputs in product cells */
    .constructions-table td.product-cell.editing input[type="number"]::-webkit-outer-spin-button,
    .constructions-table td.product-cell.editing input[type="number"]::-webkit-inner-spin-button {
        -webkit-appearance: none;
        margin: 0;
    }
    .constructions-table td.product-cell.editing input[type="number"] {
        -moz-appearance: textfield;
    }

    /* Editable construction cells */
    .constructions-table td.construction-cell.editable {
        cursor: pointer;
    }

    .constructions-table td.construction-cell.editable:hover {
        background-color: #e7f3ff;
    }

    .constructions-table td.construction-cell.editing {
        padding: 2px;
        background-color: #fff;
    }

    .constructions-table td.construction-cell.editing input {
        width: 100%;
        padding: 4px 6px;
        border: 1px solid #007bff;
        border-radius: 3px;
        font-size: 12px;
        box-sizing: border-box;
    }

    .constructions-table td.construction-cell.editing input:focus {
        outline: none;
        box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.25);
    }

    /* Product selector dropdown */
    .product-selector {
        position: absolute;
        background: white;
        border: 1px solid #ced4da;
        border-radius: 4px;
        padding: 10px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        z-index: 1000;
        min-width: 300px;
    }

    .product-selector .selector-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 8px;
    }

    .product-selector .close-selector {
        background: none;
        border: none;
        font-size: 18px;
        cursor: pointer;
        color: #6c757d;
    }

    .product-selector .search-input {
        width: 100%;
        padding: 6px 8px;
        border: 1px solid #ced4da;
        border-radius: 4px;
        font-size: 13px;
        margin-bottom: 8px;
    }

    .product-selector select {
        width: 100%;
        padding: 6px 8px;
        border: 1px solid #ced4da;
        border-radius: 4px;
        font-size: 13px;
    }

    .product-selector .add-btn {
        width: 100%;
        margin-top: 8px;
    }

    .constructions-table tbody tr:hover td {
        background-color: #f0f7ff;
    }

    /* Column visibility controls */
    .column-controls {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-bottom: 10px;
        flex-wrap: wrap;
    }

    .column-controls-label {
        font-size: 13px;
        color: #6c757d;
    }

    .column-toggle-group {
        display: flex;
        align-items: center;
        gap: 5px;
        background: #f8f9fa;
        padding: 5px 10px;
        border-radius: 4px;
        border: 1px solid #dee2e6;
    }

    .column-toggle-group label {
        font-size: 12px;
        margin: 0;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 4px;
    }

    .column-toggle-group input[type="checkbox"] {
        cursor: pointer;
    }

    .column-toggle-all {
        font-weight: 500;
        border-right: 1px solid #dee2e6;
        padding-right: 8px;
        margin-right: 3px;
    }

    /* Hidden column styles */
    .constructions-table th.col-hidden,
    .constructions-table td.col-hidden {
        display: none;
    }

    /* Totals row */
    .totals-row {
        background-color: #f8f9fa;
        font-weight: bold;
    }

    .totals-row td {
        border-top: 2px solid #007bff;
        padding: 12px 8px;
    }

    .add-row-btn {
        margin-top: 15px;
    }

    /* Modal styles */
    .modal-backdrop {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        z-index: 1040;
    }

    .modal-backdrop.show {
        display: block;
        opacity: 1 !important;
    }

    .modal-dialog-custom {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: white;
        background-color: #ffffff;
        opacity: 1;
        border-radius: 8px;
        padding: 20px;
        max-width: 600px;
        width: 90%;
        max-height: 90vh;
        overflow-y: auto;
        z-index: 1050;
        box-shadow: 0 5px 15px rgba(0,0,0,0.3);
    }

    .form-group {
        margin-bottom: 15px;
    }

    .form-group label {
        display: block;
        margin-bottom: 5px;
        font-weight: 500;
    }

    .form-control-custom {
        width: 100%;
        padding: 8px;
        border: 1px solid #ced4da;
        border-radius: 4px;
        font-size: 14px;
    }

    textarea.form-control-custom {
        min-height: 80px;
        resize: vertical;
    }

    .btn-group-custom {
        display: flex;
        gap: 10px;
        justify-content: flex-end;
        margin-top: 20px;
    }

    .section-title {
        font-size: 20px;
        font-weight: bold;
        margin-bottom: 15px;
        padding-bottom: 10px;
        border-bottom: 2px solid #007bff;
    }

    .hidden {
        display: none !important;
    }

    /* Delete button styles */
    .btn-delete-row {
        padding: 4px 8px;
        font-size: 16px;
        background: none;
        border: none;
        color: #dc3545;
        cursor: pointer;
        opacity: 0.7;
        transition: opacity 0.2s;
    }

    .btn-delete-row:hover {
        opacity: 1;
    }

    /* Delete confirmation modals z-index */
    #deleteEstimateModalBackdrop,
    #deleteConstructionModalBackdrop {
        z-index: 1060;
    }

    #deleteEstimateModalBackdrop .modal-dialog-custom,
    #deleteConstructionModalBackdrop .modal-dialog-custom {
        z-index: 1070;
    }

    /* Form with button styles */
    .form-group-with-button {
        display: flex;
        align-items: flex-end;
        gap: 0;
    }

    .form-group-with-button > div:first-child {
        flex: 1;
    }

    .form-group-with-button .form-group {
        margin-bottom: 0;
    }

    .btn-icon {
        padding: 6px 10px;
        margin-left: 8px;
    }

    /* Bulk add product icon in header */
    .bulk-add-product-icon {
        display: none;
        color: #007bff;
        cursor: pointer;
        font-size: 20px;
        font-weight: bold;
        float: right;
        vertical-align: middle;
    }

    .bulk-add-product-icon:hover {
        color: #0056b3;
    }

    .bulk-add-product-icon.visible {
        display: inline;
    }

    /* Add construction button */
    .btn-add-construction {
        white-space: nowrap;
        margin-right: 15px;
    }

    /* Bulk delete button */
    .btn-bulk-delete {
        display: none;
        background: #dc3545;
        color: white;
        border: none;
        padding: 6px 12px;
        border-radius: 4px;
        cursor: pointer;
        font-size: 14px;
        align-items: center;
        gap: 5px;
        margin-left: auto;
    }

    .btn-bulk-delete:hover {
        background: #c82333;
    }

    .btn-bulk-delete.visible {
        display: inline-flex;
    }

    .btn-bulk-delete .delete-icon {
        font-size: 14px;
    }

    /* Delete progress modal */
    .delete-progress-container {
        text-align: center;
        padding: 20px 0;
    }

    .delete-progress-spinner {
        width: 40px;
        height: 40px;
        border: 4px solid #f3f3f3;
        border-top: 4px solid #dc3545;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin: 0 auto 15px;
    }

    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }

    .delete-progress-text {
        font-size: 16px;
        color: #495057;
    }

    .delete-progress-counter {
        font-weight: bold;
        color: #dc3545;
    }
</style>

<div class="project-list-container">
    <div class="section-title">–†–∞–±–æ—á–µ–µ –º–µ—Å—Ç–æ –ø—Ä–æ–µ–∫—Ç–∞</div>

    <div class="controls-row">
        <input type="text" class="search-box" id="projectSearch" placeholder="–ü–æ–∏—Å–∫ –ø–æ –ª—é–±–æ–º—É –ø–æ–ª—é..." onkeyup="filterProjects()">
    </div>

    <div class="project-list" id="projectList">
        <!-- Projects will be loaded here -->
    </div>

    <!-- Project Detail View -->
    <div class="project-detail-view" id="projectDetailView">
        <!-- Header row -->
        <div class="project-detail-header">
            <a href="#" class="project-detail-title" id="projectDetailTitle" onclick="showEditProjectModal(); return false;">-</a>
            <a href="#" class="edit-external-link" id="projectEditLink" target="_blank" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ –Ω–æ–≤–æ–º –æ–∫–Ω–µ">&#9998;</a>
            <span class="completeness-badge" id="projectCompleteness">–ó–∞–ø–æ–ª–Ω–µ–Ω–Ω–æ—Å—Ç—å: 0%</span>
            <button class="close-detail-btn" onclick="closeProjectDetail()" title="–ó–∞–∫—Ä—ã—Ç—å">&times;</button>
        </div>

        <!-- Info table -->
        <table class="project-info-table" id="projectInfoTable">
            <tr>
                <td class="label">–ó–∞–∫–∞–∑—á–∏–∫:</td>
                <td class="value" id="infoClient">-</td>
                <td class="label">–û–±—ä–µ–∫—Ç:</td>
                <td class="value" id="infoObject">-</td>
                <td class="label">–°—Ä–æ–∫, –¥–Ω–µ–π:</td>
                <td class="value" id="infoDuration">-</td>
            </tr>
            <tr>
                <td class="label">–ê–≤–∞–Ω—Å, %:</td>
                <td class="value" id="infoAdvance">-</td>
                <td class="label">–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ:</td>
                <td class="value" id="infoLocation">-</td>
                <td class="label">–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã:</td>
                <td class="value" id="infoCoordinates">-</td>
            </tr>
        </table>

        <!-- Tabs -->
        <div class="detail-tabs">
            <div class="detail-tab active" data-tab="estimate" onclick="switchTab('estimate')">–°–º–µ—Ç–∞</div>
            <div class="detail-tab" data-tab="constructions" onclick="switchTab('constructions')">–ö–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏</div>
        </div>

        <!-- Estimate Tab Content -->
        <div class="tab-content active" id="estimateTab">
            <div class="controls-row">
                <button class="btn btn-primary btn-sm" onclick="addEstimateRow()">+ –î–æ–±–∞–≤–∏—Ç—å —Å—Ç—Ä–æ–∫—É</button>
            </div>
            <div class="estimate-table-container">
                <table class="estimate-table">
                    <thead>
                        <tr>
                            <th>‚Ññ</th>
                            <th>–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç</th>
                            <th>–ö-–≤–æ</th>
                            <th>–ï–¥. –∏–∑–º.</th>
                            <th>–¶–µ–Ω–∞</th>
                            <th>–°—É–º–º–∞</th>
                            <th>–í–∏–¥—ã —Ä–∞–±–æ—Ç</th>
                            <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                        </tr>
                    </thead>
                    <tbody id="estimateTableBody">
                        <!-- Estimate rows will be loaded here -->
                    </tbody>
                    <tfoot>
                        <tr class="totals-row">
                            <td colspan="5" style="text-align: right;">–ò—Ç–æ–≥–æ:</td>
                            <td class="sum-cell" id="estimateTotalSum">0.00</td>
                            <td colspan="2"></td>
                        </tr>
                    </tfoot>
                </table>
            </div>
        </div>

        <!-- Constructions Tab Content -->
        <div class="tab-content" id="constructionsTab">
            <!-- Controls row with add button and column visibility -->
            <div class="column-controls">
                <button class="btn btn-primary btn-sm btn-add-construction" onclick="promptAddConstruction()">+&nbsp;–ö–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏—è</button>
                <span class="column-controls-label">–ö–æ–ª–æ–Ω–∫–∏:</span>
                <div class="column-toggle-group">
                    <label class="column-toggle-all">
                        <input type="checkbox" id="toggleAllHideable" checked onchange="toggleAllHideableColumns(this.checked)">
                        –í—Å–µ
                    </label>
                    <label><input type="checkbox" data-col="doc" checked onchange="toggleColumn('doc', this.checked)"> –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è</label>
                    <label><input type="checkbox" data-col="zahvatka" checked onchange="toggleColumn('zahvatka', this.checked)"> –ó–∞—Ö–≤–∞—Ç–∫–∞</label>
                    <label><input type="checkbox" data-col="osi" checked onchange="toggleColumn('osi', this.checked)"> –û—Å–∏</label>
                    <label><input type="checkbox" data-col="vysotm" checked onchange="toggleColumn('vysotm', this.checked)"> –í—ã—Å.–æ—Ç–º.</label>
                    <label><input type="checkbox" data-col="etazh" checked onchange="toggleColumn('etazh', this.checked)"> –≠—Ç–∞–∂</label>
                    <label><input type="checkbox" id="toggleProductDetails" checked onchange="toggleProductDetailsColumns(this.checked)"> –î–µ—Ç–∞–ª–∏ –∏–∑–¥–µ–ª–∏–π</label>
                </div>
                <button class="btn-bulk-delete btn-sm " id="btnBulkDelete" onclick="showBulkDeleteConfirmation()">
                    <span class="delete-icon">üóë</span>
                    <span id="bulkDeleteCount">–£–¥–∞–ª–∏—Ç—å</span>
                </button>
            </div>
            <div class="constructions-table-container">
                <table class="constructions-table">
                    <thead>
                        <tr>
                            <th>‚Ññ</th>
                            <th class="col-checkbox" title="–í—ã–±—Ä–∞—Ç—å –≤—Å–µ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏"><input type="checkbox" class="compact-checkbox" id="checkAllConstructions" onchange="toggleColumnCheckboxes('construction', this.checked)"></th>
                            <th class="col-construction">–ö–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏—è</th>
                            <th class="col-construction" data-col="doc">–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è</th>
                            <th class="col-construction" data-col="zahvatka">–ó–∞—Ö–≤–∞—Ç–∫–∞</th>
                            <th class="col-construction" data-col="osi">–û—Å–∏</th>
                            <th class="col-construction" data-col="vysotm">–í—ã—Å.–æ—Ç–º.</th>
                            <th class="col-construction" data-col="etazh">–≠—Ç–∞–∂</th>
                            <th class="col-checkbox" title="–í—ã–±—Ä–∞—Ç—å –≤—Å–µ –ø–æ–∑–∏—Ü–∏–∏ —Å–º–µ—Ç—ã"><input type="checkbox" class="compact-checkbox" id="checkAllEstimates" onchange="toggleColumnCheckboxes('estimate', this.checked)"></th>
                            <th class="col-estimate">–ü–æ–∑–∏—Ü–∏—è —Å–º–µ—Ç—ã <span id="bulkAddProductIcon" class="bulk-add-product-icon" onclick="showBulkProductSelector(event)" title="–î–æ–±–∞–≤–∏—Ç—å –∏–∑–¥–µ–ª–∏–µ –∫ –≤—ã–±—Ä–∞–Ω–Ω—ã–º –ø–æ–∑–∏—Ü–∏—è–º">+</span></th>
                            <th class="col-checkbox" title="–í—ã–±—Ä–∞—Ç—å –≤—Å–µ –∏–∑–¥–µ–ª–∏—è"><input type="checkbox" class="compact-checkbox" id="checkAllProducts" onchange="toggleColumnCheckboxes('product', this.checked)"></th>
                            <th class="col-product">–ò–∑–¥–µ–ª–∏–µ</th>
                            <th class="col-product">–ú–∞—Ä–∫–∏—Ä–æ–≤–∫–∞</th>
                            <th class="col-product">–î–æ–∫—É–º.</th>
                            <th class="col-product" data-col="product-detail">–í—ã—Å.–ø–æ–ª–∞</th>
                            <th class="col-product" data-col="product-detail">–î–ª–∏–Ω–∞</th>
                            <th class="col-product" data-col="product-detail">–í—ã—Å–æ—Ç–∞</th>
                            <th class="col-product" data-col="product-detail">–ü–µ—Ä–∏–º–µ—Ç—Ä</th>
                            <th class="col-product" data-col="product-detail">–ü–ª–æ—â–∞–¥—å</th>
                            <th class="col-product" data-col="product-detail">–í–µ—Å –º¬≤</th>
                            <th class="col-product" data-col="product-detail">–í–µ—Å 1—à—Ç</th>
                            <th class="col-product">–ï–¥.–∏–∑–º.</th>
                            <th class="col-product">–ö–æ–ª-–≤–æ</th>
                        </tr>
                    </thead>
                    <tbody id="constructionsTableBody">
                        <!-- Construction rows will be loaded here -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<!-- Edit Project Modal -->
<div class="modal-backdrop" id="projectModalBackdrop" onclick="closeProjectModal()">
    <div class="modal-dialog-custom" onclick="event.stopPropagation()">
        <h5 id="projectModalTitle">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–µ–∫—Ç</h5>
        <form id="projectForm">
            <input type="hidden" id="projectId">

            <div class="form-group">
                <label for="projectName">–ü—Ä–æ–µ–∫—Ç *</label>
                <input type="text" class="form-control-custom" id="projectName" required>
            </div>

            <div class="form-group">
                <label for="projectDescription">–û–ø–∏—Å–∞–Ω–∏–µ</label>
                <textarea class="form-control-custom" id="projectDescription"></textarea>
            </div>

            <div class="form-group-with-button">
                <div class="form-group">
                    <label for="projectClient">–ó–∞–∫–∞–∑—á–∏–∫</label>
                    <select class="form-control-custom" id="projectClient">
                        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∑–∞–∫–∞–∑—á–∏–∫–∞</option>
                    </select>
                </div>
                <button type="button" class="btn btn-sm btn-outline-primary btn-icon" onclick="showAddClientModal()" title="–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ–≥–æ –∑–∞–∫–∞–∑—á–∏–∫–∞">+</button>
            </div>

            <div class="form-group-with-button">
                <div class="form-group">
                    <label for="projectObject">–û–±—ä–µ–∫—Ç</label>
                    <select class="form-control-custom" id="projectObject">
                        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –æ–±—ä–µ–∫—Ç</option>
                    </select>
                </div>
                <button type="button" class="btn btn-sm btn-outline-primary btn-icon" onclick="showAddObjectModal()" title="–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π –æ–±—ä–µ–∫—Ç">+</button>
            </div>

            <div class="form-group">
                <label for="projectStart">–°—Ç–∞—Ä—Ç</label>
                <input type="date" class="form-control-custom" id="projectStart">
            </div>

            <div class="form-group">
                <label for="projectDuration">–°—Ä–æ–∫ (–∫–∞–ª–µ–Ω–¥–∞—Ä–Ω—ã—Ö –¥–Ω–µ–π)</label>
                <input type="number" class="form-control-custom" id="projectDuration" min="1" step="1">
            </div>

            <div class="form-group">
                <label for="projectDeadline">–û–∫–æ–Ω—á–∞–Ω–∏–µ</label>
                <input type="date" class="form-control-custom" id="projectDeadline">
            </div>

            <div class="btn-group-custom">
                <button type="button" class="btn btn-outline-secondary" onclick="closeProjectModal()">–û—Ç–º–µ–Ω–∞</button>
                <button type="submit" class="btn btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            </div>
        </form>
    </div>
</div>

<!-- Delete Estimate Row Modal -->
<div class="modal-backdrop" id="deleteEstimateModalBackdrop" onclick="closeDeleteEstimateModal()">
    <div class="modal-dialog-custom" onclick="event.stopPropagation()">
        <h5>–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–∏—è</h5>
        <p>–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç—É —Å—Ç—Ä–æ–∫—É —Å–º–µ—Ç—ã?</p>
        <div class="btn-group-custom">
            <button type="button" class="btn btn-outline-secondary" onclick="closeDeleteEstimateModal()">–û—Ç–º–µ–Ω–∞</button>
            <button type="button" class="btn btn-danger" onclick="confirmDeleteEstimateRow()">–£–¥–∞–ª–∏—Ç—å</button>
        </div>
    </div>
</div>

<!-- Delete Construction Row Modal -->
<div class="modal-backdrop" id="deleteConstructionModalBackdrop" onclick="closeDeleteConstructionModal()">
    <div class="modal-dialog-custom" onclick="event.stopPropagation()">
        <h5>–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–∏—è</h5>
        <p>–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç—É —Å—Ç—Ä–æ–∫—É –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏?</p>
        <div class="btn-group-custom">
            <button type="button" class="btn btn-outline-secondary" onclick="closeDeleteConstructionModal()">–û—Ç–º–µ–Ω–∞</button>
            <button type="button" class="btn btn-danger" onclick="confirmDeleteConstructionRow()">–£–¥–∞–ª–∏—Ç—å</button>
        </div>
    </div>
</div>

<!-- Add Client Modal -->
<div class="modal-backdrop" id="clientModalBackdrop" onclick="closeClientModal()">
    <div class="modal-dialog-custom" onclick="event.stopPropagation()">
        <h5>–î–æ–±–∞–≤–∏—Ç—å –∑–∞–∫–∞–∑—á–∏–∫–∞</h5>
        <form id="clientForm">
            <div class="form-group">
                <label for="clientName">–ù–∞–∑–≤–∞–Ω–∏–µ –∑–∞–∫–∞–∑—á–∏–∫–∞ *</label>
                <input type="text" class="form-control-custom" id="clientName" required>
            </div>
            <div class="btn-group-custom">
                <button type="button" class="btn btn-outline-secondary" onclick="closeClientModal()">–û—Ç–º–µ–Ω–∞</button>
                <button type="submit" class="btn btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            </div>
        </form>
    </div>
</div>

<!-- Add Object Modal -->
<div class="modal-backdrop" id="objectModalBackdrop" onclick="closeObjectModal()">
    <div class="modal-dialog-custom" onclick="event.stopPropagation()">
        <h5>–î–æ–±–∞–≤–∏—Ç—å –æ–±—ä–µ–∫—Ç</h5>
        <form id="objectForm">
            <div class="form-group">
                <label for="objectName">–ù–∞–∑–≤–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞ *</label>
                <input type="text" class="form-control-custom" id="objectName" required>
            </div>
            <div class="form-group">
                <label for="objectCoordinates">–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã</label>
                <input type="text" class="form-control-custom" id="objectCoordinates" placeholder="55.7558, 37.6173">
            </div>
            <div class="btn-group-custom">
                <button type="button" class="btn btn-outline-secondary" onclick="closeObjectModal()">–û—Ç–º–µ–Ω–∞</button>
                <button type="submit" class="btn btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            </div>
        </form>
    </div>
</div>

<!-- Work Type Selector (dynamically positioned) -->
<div class="work-type-selector hidden" id="workTypeSelector">
    <div class="selector-header">
        <strong>–î–æ–±–∞–≤–∏—Ç—å –≤–∏–¥ —Ä–∞–±–æ—Ç</strong>
        <button class="close-selector" onclick="closeWorkTypeSelector()">&times;</button>
    </div>
    <div class="form-group">
        <label>–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</label>
        <select id="selectorDirection" onchange="onSelectorDirectionChange()">
            <option value="">–í—Å–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è</option>
        </select>
    </div>
    <div class="form-group">
        <label>–í–∏–¥ —Ä–∞–±–æ—Ç</label>
        <input type="text" class="search-input" id="selectorWorkTypeSearch" placeholder="–ü–æ–∏—Å–∫..." oninput="filterSelectorWorkTypes()">
        <select id="selectorWorkType" size="6" style="height: auto;" ondblclick="addSelectedWorkType()">
        </select>
    </div>
    <button type="button" class="btn btn-primary add-btn" onclick="addSelectedWorkType()">–î–æ–±–∞–≤–∏—Ç—å</button>
</div>

<!-- Product Selector (dynamically positioned) -->
<div class="product-selector hidden" id="productSelector">
    <div class="selector-header">
        <strong>–î–æ–±–∞–≤–∏—Ç—å –∏–∑–¥–µ–ª–∏–µ</strong>
        <button class="close-selector" onclick="closeProductSelector()">&times;</button>
    </div>
    <input type="text" class="search-input" id="productSelectorSearch" placeholder="–ü–æ–∏—Å–∫ –∏–∑–¥–µ–ª–∏—è..." oninput="filterProductSelector()">
    <select id="productSelectorList" size="8" style="height: auto;" ondblclick="addSelectedProduct()">
    </select>
    <button type="button" class="btn btn-primary add-btn" onclick="addSelectedProduct()">–î–æ–±–∞–≤–∏—Ç—å</button>
</div>

<!-- Bulk Delete Confirmation Modal -->
<div class="modal-backdrop" id="bulkDeleteModalBackdrop" onclick="closeBulkDeleteModal()">
    <div class="modal-dialog-custom" onclick="event.stopPropagation()">
        <h5>–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–∏—è</h5>
        <p id="bulkDeleteMessage">–£–¥–∞–ª–∏—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã?</p>
        <div class="btn-group-custom">
            <button type="button" class="btn btn-outline-secondary" onclick="closeBulkDeleteModal()">–û—Ç–º–µ–Ω–∞</button>
            <button type="button" class="btn btn-danger" onclick="confirmBulkDelete()">–£–¥–∞–ª–∏—Ç—å</button>
        </div>
    </div>
</div>

<!-- Bulk Delete Progress Modal -->
<div class="modal-backdrop" id="bulkDeleteProgressBackdrop">
    <div class="modal-dialog-custom" onclick="event.stopPropagation()">
        <div class="delete-progress-container">
            <div class="delete-progress-spinner"></div>
            <p class="delete-progress-text">–£–¥–∞–ª—è–µ–º <span class="delete-progress-counter" id="deleteProgressCounter">0 –∏–∑ 0</span></p>
        </div>
    </div>
</div>

<script>
    // Load project.js dynamically
    (function() {
        var script = document.createElement('script');
        script.src = 'https://' + window.location.host + '/download/' + db + '/js/project.js?' + Math.random();
        script.onload = function() {
            if (typeof initProjectWorkspace === 'function') {
                initProjectWorkspace();
            }
        };
        document.head.appendChild(script);
    })();
</script>
